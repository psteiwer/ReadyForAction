<!-- GENERATED BY CHATGPT -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Delay Report</title>
  <style>
    :root {
      --primary-color: #006990;
      --secondary-color: #00B2A9;
      --accent-color: #2F2A95;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f0f8fa;
      color: #333;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: var(--primary-color);
      color: white;
      padding: 1rem;
      text-align: center;
    }

    .flight-container {
      max-width: 600px;
      margin: 2rem auto;
      background-color: white;
      border: 1px solid var(--accent-color);
      border-radius: 5px;
      padding: 1rem;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .flight-detail {
      margin: 0.5rem 0;
    }

    .delay-info {
      background-color: var(--secondary-color);
      color: white;
      padding: 0.5rem;
      border-radius: 3px;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Delay Report</h1>
  </header>

  <div class="flight-container" id="flightInfo">
    <!-- Flight information will be injected here -->
  </div>

  <script>
    const delayReasons = {
      "Carrier": "Mechanical issue, crew scheduling problem, or airline operation delay.",
      "Late Aircraft": "Previous flight arrived late causing a domino delay.",
      "Security": "Security breach or extended passenger screening.",
      "Weather": "Severe weather conditions at origin or destination."
    };

    const extraDetails = {
      "Carrier": [
        "Maintenance crew was dispatched to inspect the left engine.",
        "Crew duty hours were exceeded requiring a new crew.",
        "Unexpected catering supply delay affected boarding."
      ],
      "Late Aircraft": [
        "Connecting aircraft was delayed due to gate unavailability.",
        "Previous leg had a medical emergency, causing delay.",
        "Extended turnaround time due to luggage offloading."
      ],
      "Security": [
        "Random passenger screening delayed the boarding process.",
        "Extra baggage inspection required due to alerts.",
        "Airport security lockdown due to unattended item."
      ],
      "Weather": [
        "Thunderstorms in the region caused temporary ground stops.",
        "Low visibility at destination required longer holding time.",
        "Snow and de-icing delays extended runway clearance time."
      ]
    };

    function getRandomItem(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    async function fetchFlightData(id) {
      try {
        const response = await fetch(`http://localhost:61773/api/READYforACTION/fetchdata/MCOFlightDelays/${id}`);
        const data = await response.json();

        const delayType = data.CauseOfDelay;
        const reason = delayReasons[delayType] || "Unknown reason.";
        const extra = getRandomItem(extraDetails[delayType] || ["No extra info available."]);

        renderFlightInfo({
          airline: data.Airline,
          date: data.Date,
          delayType,
          reason,
          extra,
          duration: data.DelayDuration
        });
      } catch (error) {
        console.error("Failed to fetch flight data:", error);
        document.getElementById("flightInfo").innerHTML = `<div class="flight-detail">Error loading flight information.</div>`;
      }
    }

    function renderFlightInfo(data) {
      const container = document.getElementById("flightInfo");

      container.innerHTML = `
        <div class="flight-detail"><strong>Airline:</strong> ${data.airline}</div>
        <div class="flight-detail"><strong>Date:</strong> ${data.date}</div>
        <div class="flight-detail"><strong>Delay Type:</strong> ${data.delayType}</div>
        <div class="flight-detail"><strong>Delay Duration:</strong> ${data.duration} minutes</div>
        <div class="delay-info">
          <div><strong>Reason:</strong> ${data.reason}</div>
          <div><strong>Details:</strong> ${data.extra}</div>
        </div>
      `;
    }

    // Extract ID from URL parameters and fetch
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    if (id) {
      fetchFlightData(id);
    } else {
      document.getElementById("flightInfo").innerHTML = `<div class="flight-detail">No ID provided in URL.</div>`;
    }
  </script>
</body>
</html>
